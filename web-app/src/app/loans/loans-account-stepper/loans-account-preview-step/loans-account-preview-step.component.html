<div data-layout="column">

  <h3 class="mat-h3" >Details</h3>

  <mat-divider ></mat-divider>

  <div >
    <span data-flex="40">Product:</span>
    <span data-flex="60">{{ loansAccount.productId | find:loansAccountTemplate.productOptions:'id':'name' }}</span>
  </div>

  <div  *ngIf="loansAccount.loanOfficerId">
    <span data-flex="40">Loan officer:</span>
    <span
    data-flex="60">{{ loansAccount.loanOfficerId | find:loansAccountProductTemplate.loanOfficerOptions:'id':'displayName'}}</span>
  </div>

  <div  *ngIf="loansAccount.loanPurposeId">
    <span data-flex="40">Loan purpose:</span>
    <span
    data-flex="60">{{ loansAccount.loanPurposeId | find:loansAccountProductTemplate.loanPurposeOptions:'id':'name'}}</span>
  </div>

  <div  *ngIf="loansAccount.fundId">
    <span data-flex="40">Fund:</span>
    <span data-flex="60">{{ loansAccount.fundId | find:loansAccountProductTemplate.fundOptions:'id':'name'}}</span>
  </div>

  <div >
    <span data-flex="40">Submitted on:</span>
    <span data-flex="60">{{ loansAccount.submittedOnDate  | dateFormat }}</span>
  </div>

  <div >
    <span data-flex="40">Disbursement on:</span>
    <span data-flex="60">{{ loansAccount.expectedDisbursementDate  | dateFormat }}</span>
  </div>

  <div  *ngIf="loansAccount.externalId">
    <span data-flex="40">External id:</span>
    <span data-flex="60">{{ loansAccount.externalId }}</span>
  </div>

  <h3 class="mat-h3" >Terms</h3>

  <mat-divider ></mat-divider>

  <div >
    <span data-flex="40">Principal:</span>
    <span data-flex="60">{{ loansAccount.principal }} {{loansAccountProductTemplate.currency.DisplaySymbol}}</span>
  </div>

  <div >
    <span data-flex="40">Loan term:</span>
    <span data-flex="60">{{ loansAccount.loanTermFrequency }}
      {{loansAccount.loanTermFrequencyType | find: loansAccountProductTemplate.termFrequencyTypeOptions:'id':'name'}}</span>
  </div>

  <div >
    <span data-flex="40">Number of repayments:</span>
    <span data-flex="60">{{ loansAccount.numberOfRepayments }}</span>
  </div>

  <div>
    <span data-flex="40">Repaid every:</span>
    <span data-flex="60">{{loansAccount.repaymentEvery}}
      {{loansAccount.repaymentFrequencyType | find: loansAccountProductTemplate.termFrequencyTypeOptions:'id':'name'}}
      {{loansAccount.repaymentFrequencyNthDayType | find: loansAccountProductTemplate.repaymentFrequencyNthDayTypeOptions:'id': 'name'}}
      {{loansAccount.repaymentFrequencyDayOfWeekType | find: loansAccountProductTemplate.repaymentFrequencyDaysOfWeekTypeOptions:'id': 'name'}}</span>
  </div>

  <div  *ngIf="loansAccount.repaymentsStartingFromDate">
    <span data-flex="40">First repayment on:</span>
    <span data-flex="60">{{ loansAccount.repaymentsStartingFromDate  | dateFormat }}</span>
  </div>

  <div  *ngIf="loansAccount.interestChargedFromDate">
    <span data-flex="40">Interest charged from:</span>
    <span data-flex="60">{{ loansAccount.interestChargedFromDate  | dateFormat }}</span>
  </div>

  <div  *ngIf="loansAccount.interestRatePerPeriod">
    <span data-flex="40">Nominal interest rate:</span>
    <span
    data-flex="60">{{loansAccount.interestRatePerPeriod}}&nbsp;&nbsp;{{loansAccountProductTemplate.interestRateFrequencyType.value}}</span>
  </div>

  <div  *ngIf="loansAccount.interestType">
    <span data-flex="40">Interest method: </span>
    <span data-flex="60">{{loansAccount.interestType}}</span>
  </div>

  <div  *ngIf="loansAccount.isEqualAmortization">
    <span data-flex="40">Is Equal Amortization:</span>
    <span data-flex="60">{{loansAccount.isEqualAmortization}}</span>
  </div>

  <div>
    <span data-flex="40">Amortization</span>
    <span
    data-flex="60">{{ loansAccount.amortizationType | find:loansAccountProductTemplate.amortizationTypeOptions:'id':'value' }}</span>
  </div>

  <div >
    <span data-flex="40">Interest calculation period: </span>
    <span
    data-flex="60">{{ loansAccount.interestCalculationPeriodType | find:loansAccountProductTemplate.interestCalculationPeriodTypeOptions:'id':'value'  }}</span>
  </div>

  <div  *ngIf="loansAccount.allowPartialPeriodInterestCalcualtion">
    <span data-flex="40">Calculate interest for exact days in partial period:</span>
    <span data-flex="60">{{ loansAccount.allowPartialPeriodInterestCalcualtion }}</span>
  </div>

  <div  *ngIf="loansAccount.inArrearsTolerance">
    <span data-flex="40">Arrears tolerance: </span>
    <span
    data-flex="60">{{loansAccount.inArrearsTolerance}}&nbsp;{{loansAccountProductTemplate.currency.displaySymbol}}</span>
  </div>

  <div  *ngIf="loansAccount.graceOnInterestCharged">
    <span data-flex="40">Interest free period: </span>
    <span data-flex="60">{{ loansAccount.graceOnInterestCharged }}</span>
  </div>

  <div >
    <span data-flex="40">Repayment strategy: </span>
    <span
      data-flex="60">{{ loansAccount.transactionProcessingStrategyId | find:loansAccountProductTemplate.transactionProcessingStrategyOptions:'id':'name' }}</span>
  </div>

  <h3 class="mat-h3" >Moratorium</h3>

  <mat-divider ></mat-divider>

  <div fxFlexFill *ngIf="loansAccount.graceOnPrincipalPayment">
    <span data-flex="40">On principal payment: </span>
    <span data-flex="60">{{ loansAccount.graceOnPrincipalPayment }}</span>
  </div>

  <div  *ngIf="loansAccount.graceOnInterestPayment">
    <span data-flex="40">On interest payment: </span>
    <span data-flex="60">{{ loansAccount.graceOnInterestPayment }}</span>
  </div>

  <div  *ngIf="loansAccount.graceOnArrearsAgeing">
    <span data-flex="40">On Arrears Aging: </span>
    <span data-flex="60">{{ loansAccount.graceOnArrearsAgeing }}</span>
  </div>

  <div  *ngIf="loansAccount.isTopup">
    <span data-flex="40">Is Topup Loan? </span>
    <span data-flex="60">{{ loansAccount.isTopup }}</span>
  </div>

  <div>
    <span data-flex="40">Recalculate Interest: </span>
    <span data-flex="60">{{ loansAccountProductTemplate?.isInterestRecalculationEnabled? 'Yes' : 'No' }}</span>
  </div>

  <div  *ngIf="loansAccountProductTemplate?.daysInMonthType">
    <span data-flex="40">Days in month: </span>
    <span data-flex="60">{{ loansAccountProductTemplate?.daysInMonthType.value }}</span>
  </div>

  <div  *ngIf="loansAccount.charges.length" data-layout="column" >

    <h3 class="mat-h3" >Charges</h3>

    



    <div>
    <table  class="mat-elevation-z1" mat-table [dataSource]="loansAccount.charges">

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef> Name </th>
        <td mat-cell *matCellDef="let charge">
          {{ charge.name + ', ' + charge.currency.displaySymbol }}
        </td>
      </ng-container>

      <ng-container matColumnDef="chargeCalculationType">
        <th mat-header-cell *matHeaderCellDef> Type </th>
        <td mat-cell *matCellDef="let charge">
          {{ charge.chargeCalculationType.value }}
        </td>
      </ng-container>

      <ng-container matColumnDef="amount">
        <th mat-header-cell *matHeaderCellDef> Amount </th>
        <td mat-cell *matCellDef="let charge">
          {{ charge.amount }}
        </td>
      </ng-container>

      <ng-container matColumnDef="chargeTimeType">
        <th mat-header-cell *matHeaderCellDef> Collected On </th>
        <td mat-cell *matCellDef="let charge">
          {{ charge.chargeTimeType.value }}
        </td>
      </ng-container>

      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef> Date </th>
        <td mat-cell *matCellDef="let charge">
          <span
            *ngIf="charge.chargeTimeType.value === 'Specified due date' || charge.chargeTimeType.value === 'Weekly Fee'">
            {{(charge.dueDate  | dateFormat) || 'Unassigned'}}
          </span>
          <span *ngIf="charge.chargeTimeType.value === 'Monthly Fee' || charge.chargeTimeType.value === 'Annual Fee'">
            {{(charge.feeOnMonthDay  | dateFormat) || 'Unassigned'}}
          </span>
          <span
            *ngIf="!(charge.chargeTimeType.value === 'Monthly Fee' || charge.chargeTimeType.value === 'Annual Fee'
                  || charge.chargeTimeType.value === 'Specified due date' || charge.chargeTimeType.value === 'Weekly Fee')">
            N/A
          </span>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="chargesDisplayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: chargesDisplayedColumns;"></tr>

    </table>
    </div>

  </div>

  <div  *ngIf="loansAccountProductTemplate.overdueCharges.length">

    <h3  class="mat-h3">Overdue Charges</h3>

    <mat-divider ></mat-divider>

    <table mat-table class="mat-elevation-z1" [dataSource]="loansAccountProductTemplate.overdueCharges">

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef> Name </th>
        <td mat-cell *matCellDef="let charge"> {{ charge.name }},{{ charge.currency.displaySymbol }} </td>
      </ng-container>

      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef> Type </th>
        <td mat-cell *matCellDef="let charge"> {{ charge.chargeCalculationType.value }} </td>
      </ng-container>

      <ng-container matColumnDef="amount">
        <th mat-header-cell *matHeaderCellDef> Amount </th>
        <td mat-cell *matCellDef="let charge"> {{ charge.amount| number }} </td>
      </ng-container>

      <ng-container matColumnDef="collectedon">
        <th mat-header-cell *matHeaderCellDef> Collected On </th>
        <td mat-cell *matCellDef="let charge"> {{ charge.chargeTimeType.value }} </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="overdueChargesDisplayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: overdueChargesDisplayedColumns;"></tr>
    </table>
  </div>


  <div  *ngIf="loansAccountProductTemplate.bounceCharge.length">

    <h3  class="mat-h3">Bounce Charges</h3>

    <mat-divider ></mat-divider>

    <table mat-table class="mat-elevation-z1" [dataSource]="loansAccountProductTemplate.bounceCharge">

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef> Name </th>
        <td mat-cell *matCellDef="let charge"> {{ charge.name }},{{ charge.currency.displaySymbol }} </td>
      </ng-container>

      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef> Type </th>
        <td mat-cell *matCellDef="let charge"> Flat </td>
      </ng-container>

      <ng-container matColumnDef="amount">
        <th mat-header-cell *matHeaderCellDef> Amount </th>
        <td mat-cell *matCellDef="let charge"> {{ charge.amount| number }} </td>
      </ng-container>

      <ng-container matColumnDef="collectedon">
        <th mat-header-cell *matHeaderCellDef> Collected On </th>
        <td mat-cell *matCellDef="let charge"> {{ charge.chargeTimeType.value }} </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="bounceChargesDisplayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: bounceChargesDisplayedColumns;"></tr>
    </table>
  </div>

</div>

<div data-layout="row" class="margin-t"  data-layout-align="center center" data-layout-gap="5px">
  <button mat-raised-button matStepperPrevious>
    <fa-icon icon="arrow-left"></fa-icon>&nbsp;&nbsp;
    Previous
  </button>
  <button mat-raised-button [routerLink]="['../']">
    Cancel
  </button>
  <button mat-raised-button color="primary" (click)="submit.emit()">
    Submit
  </button>
</div>
